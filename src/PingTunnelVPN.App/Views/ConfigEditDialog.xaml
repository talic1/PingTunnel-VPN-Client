<Window x:Class="PingTunnelVPN.App.Views.ConfigEditDialog"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        mc:Ignorable="d"
        Title="Add Configuration" 
        Height="720" 
        Width="420"
        MinHeight="380"
        MinWidth="380"
        WindowStartupLocation="CenterOwner"
        Background="{DynamicResource Brush.Background.App}"
        ResizeMode="NoResize"
        WindowStyle="None"
        AllowsTransparency="True">
    
    <Window.Resources>
        <Style x:Key="CloseButton" TargetType="Button">
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="Foreground" Value="{DynamicResource Brush.Text.Muted}"/>
            <Setter Property="Width" Value="32"/>
            <Setter Property="Height" Value="32"/>
            <Setter Property="Padding" Value="0"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border x:Name="Border"
                                Background="{TemplateBinding Background}"
                                CornerRadius="6">
                            <Path Data="{DynamicResource Icon.Close}"
                                  Fill="{TemplateBinding Foreground}"
                                  Width="12" Height="12"
                                  Stretch="Uniform"
                                  HorizontalAlignment="Center"
                                  VerticalAlignment="Center"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter Property="Background" Value="{DynamicResource Brush.Background.Hover}"/>
                                <Setter Property="Foreground" Value="{DynamicResource Brush.Text.Primary}"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>
    </Window.Resources>
    
    <!-- Dialog Card -->
    <Border Background="{DynamicResource Brush.Background.Surface}"
            BorderBrush="{DynamicResource Brush.Border.Default}"
            BorderThickness="1"
            CornerRadius="{DynamicResource Radius.XL}">
        <Grid>
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>  <!-- Header -->
                <RowDefinition Height="*"/>     <!-- Content -->
                <RowDefinition Height="Auto"/>  <!-- Buttons -->
            </Grid.RowDefinitions>

            <!-- Header -->
            <Grid Grid.Row="0" Margin="24,24,24,0">
                <TextBlock x:Name="DialogTitle"
                           Text="Add Configuration"
                           Style="{DynamicResource Text.Header}"
                           VerticalAlignment="Center"/>
                <Button Style="{StaticResource CloseButton}"
                        Click="CancelButton_Click"
                        HorizontalAlignment="Right"
                        VerticalAlignment="Top"
                        Margin="0,-8,-8,0"/>
            </Grid>

            <!-- Content with ScrollViewer -->
            <ScrollViewer Grid.Row="1" 
                          VerticalScrollBarVisibility="Auto"
                          Style="{DynamicResource ScrollViewer.Modern}"
                          Margin="24,16,24,0">
                <StackPanel>
                    
                    <!-- === Basic Settings Section === -->
                    <TextBlock Text="Basic Settings"
                               Style="{DynamicResource Text.SubHeader}"
                               Margin="0,0,0,12"/>
                    
                    <!-- Name (Remark) -->
                    <TextBlock Text="Name (Remark)"
                               Style="{DynamicResource Text.Label}"/>
                    <TextBox x:Name="ConfigNameTextBox"
                             Style="{DynamicResource TextBox.Modern}"
                             Text="{Binding ConfigName, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                             Tag="Server 1"
                             Margin="0,0,0,12"/>

                    <!-- Server Address -->
                    <TextBlock Text="Server Address"
                               Style="{DynamicResource Text.Label}"/>
                    <TextBox x:Name="ServerAddressTextBox"
                             Style="{DynamicResource TextBox.Modern}"
                             Text="{Binding ServerAddress, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                             Tag="1.1.1.1"
                             Margin="0,0,0,12"/>

                    <!-- Server Key -->
                    <TextBlock Text="Server Key"
                               Style="{DynamicResource Text.Label}"/>
                    <Grid Margin="0,0,0,12">
                        <PasswordBox x:Name="ServerKeyPasswordBox"
                                     Style="{DynamicResource PasswordBox.Modern}"
                                     PasswordChanged="ServerKeyPasswordBox_PasswordChanged"/>
                        <TextBox x:Name="ServerKeyTextBox"
                                 Style="{DynamicResource TextBox.Modern}"
                                 Text="{Binding ServerKey, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                 Visibility="Collapsed"/>
                        <Button x:Name="TogglePasswordButton"
                                Style="{DynamicResource Button.Icon}"
                                Click="TogglePasswordVisibility_Click"
                                HorizontalAlignment="Right"
                                Margin="0,0,4,0"
                                Width="32" Height="32">
                            <Path x:Name="PasswordToggleIcon"
                                  Data="{DynamicResource Icon.Eye}"
                                  Fill="{DynamicResource Brush.Text.Secondary}"
                                  Width="16" Height="16"
                                  Stretch="Uniform"/>
                        </Button>
                    </Grid>

                    <!-- Local SOCKS Port -->
                    <TextBlock Text="Local SOCKS Port"
                               Style="{DynamicResource Text.Label}"/>
                    <TextBox x:Name="LocalSocksPortTextBox"
                             Style="{DynamicResource TextBox.Modern}"
                             Text="{Binding LocalSocksPort, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                             Tag="1080"
                             Margin="0,0,0,16"/>
                </StackPanel>
            </ScrollViewer>

            <!-- Action Buttons -->
            <Grid Grid.Row="2" Margin="24,16,24,24">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="12"/>
                    <ColumnDefinition Width="*"/>
                </Grid.ColumnDefinitions>

                <Button Grid.Column="0"
                        Content="Cancel"
                        Style="{DynamicResource Button.Secondary}"
                        Click="CancelButton_Click"
                        Padding="0,12"/>

                <Button x:Name="SaveButton"
                        Grid.Column="2"
                        Content="Save Configuration"
                        Style="{DynamicResource Button.Primary}"
                        Click="SaveButton_Click"
                        Padding="0,12"/>
            </Grid>
        </Grid>
    </Border>
</Window>
