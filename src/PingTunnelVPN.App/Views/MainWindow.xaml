<Window x:Class="PingTunnelVPN.App.Views.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:converters="clr-namespace:PingTunnelVPN.App.Converters"
        mc:Ignorable="d"
        Title="VPN Client" 
        Height="720" 
        Width="420"
        MinHeight="600"
        MinWidth="380"
        MaxWidth="480"
        WindowStartupLocation="CenterScreen"
        Background="{DynamicResource Brush.Background.App}"
        Closing="Window_Closing"
        StateChanged="Window_StateChanged"
        WindowStyle="None"
        AllowsTransparency="True"
        ResizeMode="CanMinimize">
    
    <WindowChrome.WindowChrome>
        <WindowChrome CaptionHeight="36"
                      ResizeBorderThickness="0"
                      GlassFrameThickness="0"
                      CornerRadius="0"
                      UseAeroCaptionButtons="False"/>
    </WindowChrome.WindowChrome>
    
    <Window.Resources>
        <!-- Converters -->
        <BooleanToVisibilityConverter x:Key="BoolToVis"/>
        <converters:BoolToVisibilityConverter x:Key="BoolToVisibility"/>
        <converters:InverseBoolToVisibilityConverter x:Key="InverseBoolToVisibility"/>
        <converters:NullToBoolConverter x:Key="NullToBoolConverter"/>
        <converters:LogLevelToBadgeBackgroundConverter x:Key="LogLevelToBadgeBackground"/>
        <converters:LogLevelToBadgeForegroundConverter x:Key="LogLevelToBadgeForeground"/>
        <converters:BoolToSelectedBorderConverter x:Key="BoolToSelectedBorder"/>
    </Window.Resources>
    
    <Border Background="{DynamicResource Brush.Background.App}"
            BorderBrush="{DynamicResource Brush.Border.Default}"
            BorderThickness="1"
            CornerRadius="8">
        <Grid>
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>  <!-- Custom Titlebar -->
                <RowDefinition Height="*"/>     <!-- Main Content -->
            </Grid.RowDefinitions>

            <!-- ============================================== -->
            <!-- Custom Titlebar                                -->
            <!-- ============================================== -->
            <Grid x:Name="TitleBar" 
                  Grid.Row="0" 
                  Height="36"
                  Background="{DynamicResource Brush.Background.Surface}"
                  MouseLeftButtonDown="TitleBar_MouseLeftButtonDown">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <!-- App Icon (icon.ico) -->
                <Image x:Name="TitleBarAppIcon"
                       Grid.Column="0"
                       Width="16" Height="16"
                       Margin="12,0,8,0"
                       VerticalAlignment="Center"
                       RenderOptions.BitmapScalingMode="HighQuality"/>

                <!-- Title -->
                <TextBlock Grid.Column="1"
                           Text="VPN Client"
                           Style="{DynamicResource Text.Body}"
                           FontWeight="Medium"
                           VerticalAlignment="Center"/>

                <!-- Window Buttons -->
                <StackPanel Grid.Column="2" 
                            Orientation="Horizontal">
                    <Button Style="{DynamicResource TitleBarButton}"
                            Click="MinimizeButton_Click"
                            ToolTip="Minimize">
                        <Path Data="{DynamicResource Icon.Minimize}"
                              Fill="{DynamicResource Brush.Text.Secondary}"
                              Width="12" Height="12"
                              Stretch="Uniform"/>
                    </Button>
                    <Button Style="{DynamicResource TitleBarButton.Close}"
                            Click="CloseButton_Click"
                            ToolTip="Close">
                        <Path x:Name="CloseButtonIcon"
                              Data="{DynamicResource Icon.Close}"
                              Fill="{DynamicResource Brush.Text.Secondary}"
                              Width="12" Height="12"
                              Stretch="Uniform"/>
                    </Button>
                </StackPanel>
            </Grid>

            <!-- ============================================== -->
            <!-- Main Content                                   -->
            <!-- ============================================== -->
            <Grid Grid.Row="1" Margin="16,12,16,16">
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>      <!-- Status Header -->
                    <RowDefinition Height="Auto"/>      <!-- Traffic Stats -->
                    <RowDefinition Height="Auto"/>      <!-- Tab Bar -->
                    <RowDefinition Height="*"/>         <!-- Tab Content -->
                </Grid.RowDefinitions>

        <!-- ============================================== -->
        <!-- Status Header Card                             -->
        <!-- ============================================== -->
        <Border x:Name="StatusHeaderCard" 
                Grid.Row="0" 
                Style="{DynamicResource Card.StatusHeader}"
                Margin="0,0,0,12">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <!-- Shield Status Icon -->
                <Border x:Name="StatusIconContainer"
                        Grid.Column="0"
                        Width="52" Height="52"
                        CornerRadius="26"
                        Background="{DynamicResource Brush.Background.Elevated}"
                        Margin="0,0,16,0">
                    <Path x:Name="StatusIcon"
                          Data="{DynamicResource Icon.Shield}"
                          Fill="{DynamicResource Brush.Text.Secondary}"
                          Width="28" Height="28"
                          Stretch="Uniform"
                          HorizontalAlignment="Center"
                          VerticalAlignment="Center"/>
                </Border>

                <!-- Status Text -->
                <StackPanel Grid.Column="1" VerticalAlignment="Center">
                    <TextBlock x:Name="StatusText"
                               Text="Disconnected"
                               Style="{DynamicResource Text.Hero}"
                               FontSize="22"/>
                    <TextBlock x:Name="StatusSubText"
                               Text=""
                               Style="{DynamicResource Text.Body.Secondary}"
                               Margin="0,2,0,0"
                               Visibility="Collapsed"/>
                    <TextBlock x:Name="UptimeText"
                               Text=""
                               Style="{DynamicResource Text.Body.Secondary}"
                               Margin="0,2,0,0"/>
                </StackPanel>

                <!-- Connect/Disconnect Button -->
                <Button x:Name="ConnectButton"
                        Grid.Column="2"
                        Content="Connect"
                        Style="{DynamicResource Button.Primary}"
                        Click="ConnectButton_Click"
                        Padding="24,12"
                        VerticalAlignment="Center"/>
            </Grid>
        </Border>

        <!-- ============================================== -->
        <!-- Traffic Stats Section                          -->
        <!-- ============================================== -->
        <Grid x:Name="TrafficStatsSection" 
              Grid.Row="1" 
              Margin="0,0,0,12"
              Visibility="Collapsed">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="12"/>
                <ColumnDefinition Width="*"/>
            </Grid.ColumnDefinitions>

            <!-- Tunnel Traffic Card -->
            <Border Grid.Column="0" Style="{DynamicResource Card.Stats}">
                <StackPanel>
                    <!-- Header -->
                    <StackPanel Orientation="Horizontal" Margin="0,0,0,12">
                        <Path Data="{DynamicResource Icon.Network}"
                              Style="{DynamicResource Icon.Stroke.Small}"
                              Margin="0,0,8,0"/>
                        <TextBlock Text="Tunnel Traffic"
                                   Style="{DynamicResource Text.Caption}"
                                   VerticalAlignment="Center"/>
                    </StackPanel>
                    
                    <!-- Stats -->
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>

                        <!-- Download -->
                        <StackPanel Grid.Column="0">
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>
                                <Path Grid.Column="0"
                                      Style="{DynamicResource TrafficArrow.Down}"
                                      Margin="0,0,4,0"
                                      VerticalAlignment="Center"/>
                                <TextBlock Grid.Column="1"
                                           x:Name="TunnelDownText"
                                           Text="0B/s"
                                           Style="{DynamicResource Text.Stats.Value}"
                                           FontSize="{StaticResource FontSize.L}"
                                           TextTrimming="CharacterEllipsis"
                                           TextWrapping="NoWrap"
                                           VerticalAlignment="Center"/>
                            </Grid>
                        </StackPanel>

                        <!-- Upload -->
                        <StackPanel Grid.Column="1">
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>
                                <Path Grid.Column="0"
                                      Style="{DynamicResource TrafficArrow.Up}"
                                      Margin="0,0,4,0"
                                      VerticalAlignment="Center"/>
                                <TextBlock Grid.Column="1"
                                           x:Name="TunnelUpText"
                                           Text="0B/s"
                                           Style="{DynamicResource Text.Stats.Value}"
                                           FontSize="{StaticResource FontSize.L}"
                                           TextTrimming="CharacterEllipsis"
                                           TextWrapping="NoWrap"
                                           VerticalAlignment="Center"/>
                            </Grid>
                        </StackPanel>
                    </Grid>
                </StackPanel>
            </Border>

            <!-- Physical Network Card -->
            <Border Grid.Column="2" Style="{DynamicResource Card.Stats}">
                <StackPanel>
                    <!-- Header -->
                    <StackPanel Orientation="Horizontal" Margin="0,0,0,12">
                        <Path Data="{DynamicResource Icon.Wifi}"
                              Fill="{DynamicResource Brush.Text.Secondary}"
                              Width="16" Height="16"
                              Stretch="Uniform"
                              Margin="0,0,8,0"/>
                        <TextBlock Text="Physical Network"
                                   Style="{DynamicResource Text.Caption}"
                                   VerticalAlignment="Center"/>
                    </StackPanel>
                    
                    <!-- Stats -->
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>

                        <!-- Download -->
                        <StackPanel Grid.Column="0">
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>
                                <Path Grid.Column="0"
                                      Style="{DynamicResource TrafficArrow.Down}"
                                      Margin="0,0,4,0"
                                      VerticalAlignment="Center"/>
                                <TextBlock Grid.Column="1"
                                           x:Name="PhysicalDownText"
                                           Text="0B/s"
                                           Style="{DynamicResource Text.Stats.Value}"
                                           FontSize="{StaticResource FontSize.L}"
                                           TextTrimming="CharacterEllipsis"
                                           TextWrapping="NoWrap"
                                           VerticalAlignment="Center"/>
                            </Grid>
                        </StackPanel>

                        <!-- Upload -->
                        <StackPanel Grid.Column="1">
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>
                                <Path Grid.Column="0"
                                      Style="{DynamicResource TrafficArrow.Up}"
                                      Margin="0,0,4,0"
                                      VerticalAlignment="Center"/>
                                <TextBlock Grid.Column="1"
                                           x:Name="PhysicalUpText"
                                           Text="0B/s"
                                           Style="{DynamicResource Text.Stats.Value}"
                                           FontSize="{StaticResource FontSize.L}"
                                           TextTrimming="CharacterEllipsis"
                                           TextWrapping="NoWrap"
                                           VerticalAlignment="Center"/>
                            </Grid>
                        </StackPanel>
                    </Grid>
                </StackPanel>
            </Border>
        </Grid>

        <!-- ============================================== -->
        <!-- Tab Bar                                        -->
        <!-- ============================================== -->
        <Border Grid.Row="2" 
                Background="{DynamicResource Brush.Background.Surface}"
                CornerRadius="{DynamicResource Radius.M}"
                Padding="4"
                Margin="0,0,0,12">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*" MinWidth="135"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="*"/>
                </Grid.ColumnDefinitions>

                <RadioButton x:Name="TabConnections"
                             Grid.Column="0"
                             Content="Connections"
                             Tag="{DynamicResource Icon.Connections}"
                             Style="{DynamicResource TabButton}"
                             IsChecked="True"
                             Checked="Tab_Checked"/>
                
                <RadioButton x:Name="TabLogs"
                             Grid.Column="1"
                             Content="Logs"
                             Tag="{DynamicResource Icon.Logs}"
                             Style="{DynamicResource TabButton}"
                             Checked="Tab_Checked"/>
                
                <RadioButton x:Name="TabAdvanced"
                             Grid.Column="2"
                             Content="Advanced"
                             Tag="{DynamicResource Icon.Settings}"
                             Style="{DynamicResource TabButton}"
                             Checked="Tab_Checked"/>
            </Grid>
        </Border>

        <!-- ============================================== -->
        <!-- Tab Content                                    -->
        <!-- ============================================== -->
        <Grid Grid.Row="3">
            
            <!-- Connections Tab -->
            <Grid x:Name="ConnectionsTabContent" Visibility="Visible">
                <Grid.RowDefinitions>
                    <RowDefinition Height="*"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>

                <!-- Config List or Empty State -->
                <ScrollViewer Grid.Row="0" 
                              VerticalScrollBarVisibility="Auto"
                              Style="{DynamicResource ScrollViewer.Modern}">
                    <StackPanel>
                        <!-- Empty State (when no configs) -->
                        <StackPanel x:Name="EmptyStatePanel"
                                    HorizontalAlignment="Center"
                                    VerticalAlignment="Center"
                                    Margin="0,60,0,0"
                                    Visibility="Collapsed">
                            <Path Data="{DynamicResource Icon.Server}"
                                  Style="{DynamicResource EmptyState.Icon}"
                                  HorizontalAlignment="Center"/>
                            <TextBlock Text="Add a config to start"
                                       Style="{DynamicResource EmptyState.Text}"/>
                        </StackPanel>

                        <!-- Config List -->
                        <ItemsControl x:Name="ConfigList"
                                      ItemsSource="{Binding Configs}">
                            <ItemsControl.ItemTemplate>
                                <DataTemplate>
                                    <Border Style="{DynamicResource ConfigListItem}"
                                            BorderBrush="{Binding IsSelected, Converter={StaticResource BoolToSelectedBorder}}"
                                            MouseLeftButtonUp="ConfigItem_Click"
                                            Tag="{Binding Id}">
                                        <Grid>
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="Auto"/>
                                                <ColumnDefinition Width="*"/>
                                                <ColumnDefinition Width="Auto"/>
                                            </Grid.ColumnDefinitions>

                                            <!-- Selection/Connected Indicator -->
                                            <Grid Grid.Column="0" 
                                                  Width="20" Height="20"
                                                  Margin="0,0,12,0"
                                                  VerticalAlignment="Center">
                                                <!-- Selection radio dot (when selected but not connected) -->
                                                <Ellipse Width="18" Height="18"
                                                         Stroke="{DynamicResource Brush.Primary}"
                                                         StrokeThickness="2"
                                                         Fill="Transparent"
                                                         Visibility="{Binding IsSelected, Converter={StaticResource BoolToVis}}"/>
                                                <Ellipse Width="10" Height="10"
                                                         Fill="{DynamicResource Brush.Primary}"
                                                         Visibility="{Binding IsSelected, Converter={StaticResource BoolToVis}}"/>
                                                
                                                <!-- Connected checkmark (overlays selection when connected) -->
                                                <Path Data="{DynamicResource Icon.Check}"
                                                      Fill="{DynamicResource Brush.Success}"
                                                      Width="16" Height="16"
                                                      Stretch="Uniform"
                                                      HorizontalAlignment="Center"
                                                      VerticalAlignment="Center"
                                                      Visibility="{Binding IsConnected, Converter={StaticResource BoolToVis}}"/>
                                            </Grid>

                                            <!-- Config Info -->
                                            <StackPanel Grid.Column="1" VerticalAlignment="Center">
                                                <TextBlock Text="{Binding Name}"
                                                           Style="{DynamicResource Text.Body}"
                                                           FontWeight="Medium"/>
                                                <TextBlock Text="{Binding ServerAddress}"
                                                           Style="{DynamicResource Text.Caption}"
                                                           Margin="0,2,0,0"/>
                                            </StackPanel>

                                            <!-- Action Buttons -->
                                            <StackPanel Grid.Column="2" 
                                                        Orientation="Horizontal"
                                                        VerticalAlignment="Center">
                                                <Button Style="{DynamicResource Button.Icon}"
                                                        Click="EditConfigButton_Click"
                                                        Tag="{Binding Id}"
                                                        ToolTip="Edit">
                                                    <Path Data="{DynamicResource Icon.Edit}"
                                                          Fill="{DynamicResource Brush.Text.Secondary}"
                                                          Width="16" Height="16"
                                                          Stretch="Uniform"/>
                                                </Button>
                                                <Button Style="{DynamicResource Button.Icon}"
                                                        Click="DeleteConfigButton_Click"
                                                        Tag="{Binding Id}"
                                                        ToolTip="Delete">
                                                    <Path Data="{DynamicResource Icon.Delete}"
                                                          Fill="{DynamicResource Brush.Text.Secondary}"
                                                          Width="16" Height="16"
                                                          Stretch="Uniform"/>
                                                </Button>
                                            </StackPanel>
                                        </Grid>
                                    </Border>
                                </DataTemplate>
                            </ItemsControl.ItemTemplate>
                        </ItemsControl>
                    </StackPanel>
                </ScrollViewer>

                <!-- Add Configuration Button -->
                <Button Grid.Row="1"
                        Style="{DynamicResource Button.Primary}"
                        Click="AddConfigButton_Click"
                        Margin="0,12,0,0"
                        HorizontalAlignment="Stretch">
                    <StackPanel Orientation="Horizontal" HorizontalAlignment="Center">
                        <Path Data="{DynamicResource Icon.Plus}"
                              Fill="{DynamicResource Brush.Text.Primary}"
                              Width="16" Height="16"
                              Stretch="Uniform"
                              Margin="0,0,8,0"/>
                        <TextBlock Text="Add Configuration"
                                   Foreground="{DynamicResource Brush.Text.Primary}"
                                   FontWeight="Medium"/>
                    </StackPanel>
                </Button>
            </Grid>

            <!-- Logs Tab -->
            <Grid x:Name="LogsTabContent" Visibility="Collapsed">
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                </Grid.RowDefinitions>

                <!-- Log Action Buttons -->
                <StackPanel Grid.Row="0" Orientation="Horizontal" Margin="0,0,0,12">
                    <Button Style="{DynamicResource Button.Secondary}"
                            Click="ClearLogs_Click"
                            Margin="0,0,8,0">
                        <StackPanel Orientation="Horizontal">
                            <Path Data="{DynamicResource Icon.Clear}"
                                  Fill="{DynamicResource Brush.Text.Secondary}"
                                  Width="14" Height="14"
                                  Stretch="Uniform"
                                  Margin="0,0,6,0"/>
                            <TextBlock Text="Clear"/>
                        </StackPanel>
                    </Button>
                    <Button Style="{DynamicResource Button.Secondary}"
                            Click="ExportLogs_Click">
                        <StackPanel Orientation="Horizontal">
                            <Path Data="{DynamicResource Icon.Export}"
                                  Fill="{DynamicResource Brush.Text.Secondary}"
                                  Width="14" Height="14"
                                  Stretch="Uniform"
                                  Margin="0,0,6,0"/>
                            <TextBlock Text="Export"/>
                        </StackPanel>
                    </Button>
                </StackPanel>

                <!-- Log List -->
                <Border Grid.Row="1"
                        Background="{DynamicResource Brush.Background.Surface}"
                        CornerRadius="{DynamicResource Radius.L}"
                        Padding="8">
                    <ScrollViewer VerticalScrollBarVisibility="Auto"
                                  Style="{DynamicResource ScrollViewer.Modern}">
                        <ItemsControl x:Name="LogList"
                                      ItemsSource="{Binding FilteredLogEntries}">
                            <ItemsControl.ItemTemplate>
                                <DataTemplate>
                                    <Grid Margin="0,4">
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="Auto"/>
                                            <ColumnDefinition Width="Auto"/>
                                            <ColumnDefinition Width="*"/>
                                        </Grid.ColumnDefinitions>

                                        <!-- Timestamp -->
                                        <TextBlock Grid.Column="0"
                                                   Text="{Binding TimeString, StringFormat=[{0}]}"
                                                   Style="{DynamicResource Text.Mono}"
                                                   VerticalAlignment="Center"
                                                   Margin="0,0,8,0"/>

                                        <!-- Level Badge -->
                                        <Border Grid.Column="1"
                                                Background="{Binding Level, Converter={StaticResource LogLevelToBadgeBackground}}"
                                                CornerRadius="{DynamicResource Radius.S}"
                                                Padding="8,4"
                                                Margin="0,0,8,0"
                                                VerticalAlignment="Center">
                                            <TextBlock Text="{Binding Level}"
                                                       FontSize="11"
                                                       FontWeight="SemiBold"
                                                       Foreground="{Binding Level, Converter={StaticResource LogLevelToBadgeForeground}}"/>
                                        </Border>

                                        <!-- Message -->
                                        <TextBlock Grid.Column="2"
                                                   Text="{Binding Message}"
                                                   Style="{DynamicResource Text.Body}"
                                                   TextWrapping="Wrap"
                                                   VerticalAlignment="Center"/>
                                    </Grid>
                                </DataTemplate>
                            </ItemsControl.ItemTemplate>
                        </ItemsControl>
                    </ScrollViewer>
                </Border>
            </Grid>

            <!-- Advanced Tab -->
            <Grid x:Name="AdvancedTabContent" Visibility="Collapsed">
                <ScrollViewer VerticalScrollBarVisibility="Auto"
                              Style="{DynamicResource ScrollViewer.Modern}">
                    <StackPanel>
                        
                        <!-- Network Settings Section -->
                        <TextBlock Text="Network Settings"
                                   Style="{DynamicResource Text.SubHeader}"
                                   Margin="0,0,0,16"/>

                        <!-- MTU -->
                        <TextBlock Text="MTU (Maximum Transmission Unit)"
                                   Style="{DynamicResource Text.Label}"/>
                        <TextBox x:Name="MtuTextBox"
                                 Style="{DynamicResource TextBox.Modern}"
                                 Text="{Binding Mtu, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                 Margin="0,0,0,16"/>

                        <!-- DNS Mode -->
                        <TextBlock Text="DNS Mode"
                                   Style="{DynamicResource Text.Label}"/>
                        <ComboBox x:Name="DnsModeComboBox"
                                  Style="{DynamicResource ComboBox.Modern}"
                                  SelectedIndex="0"
                                  SelectionChanged="DnsModeComboBox_SelectionChanged"
                                  Margin="0,0,0,16">
                            <ComboBoxItem Content="Tunnel DNS (Recommended)" Style="{DynamicResource ComboBoxItem.Modern}"/>
                            <ComboBoxItem Content="System DNS" Style="{DynamicResource ComboBoxItem.Modern}"/>
                        </ComboBox>

                        <!-- DNS Servers -->
                        <TextBlock Text="DNS Servers (one per line)"
                                   Style="{DynamicResource Text.Label}"/>
                        <TextBox x:Name="DnsServersTextBox"
                                 Style="{DynamicResource TextBox.Modern}"
                                 Text="{Binding DnsServersText, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                 AcceptsReturn="True"
                                 Height="60"
                                 TextWrapping="Wrap"
                                 VerticalScrollBarVisibility="Auto"
                                 Tag="1.1.1.1&#x0a;8.8.8.8"
                                 Margin="0,0,0,16"/>

                        <!-- Bypass Subnets -->
                        <TextBlock Text="Bypass Subnets (CIDR, one per line)"
                                   Style="{DynamicResource Text.Label}"/>
                        <TextBox x:Name="BypassSubnetsTextBox"
                                 Style="{DynamicResource TextBox.Modern}"
                                 Text="{Binding BypassSubnetsText, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                 AcceptsReturn="True"
                                 Height="80"
                                 TextWrapping="Wrap"
                                 VerticalScrollBarVisibility="Auto"
                                 Tag="192.168.0.0/16&#x0a;10.0.0.0/8&#x0a;172.16.0.0/12"
                                 Margin="0,0,0,24"/>

                        <!-- Options Section -->
                        <TextBlock Text="Options"
                                   Style="{DynamicResource Text.SubHeader}"
                                   Margin="0,0,0,16"/>

                        <!-- Enable UDP Forwarding -->
                        <Border Background="{DynamicResource Brush.Background.Surface}"
                                CornerRadius="{DynamicResource Radius.M}"
                                Padding="16"
                                Margin="0,0,0,8">
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="Auto"/>
                                </Grid.ColumnDefinitions>
                                <StackPanel Grid.Column="0">
                                    <TextBlock Text="Enable UDP Forwarding"
                                               Style="{DynamicResource Text.Body}"/>
                                    <TextBlock Text="Forward UDP traffic through the tunnel"
                                               Style="{DynamicResource Text.Caption}"/>
                                </StackPanel>
                                <ToggleButton x:Name="EnableUdpToggle"
                                              Grid.Column="1"
                                              Style="{DynamicResource ToggleSwitch}"
                                              IsChecked="{Binding EnableUdp, Mode=TwoWay}"
                                              VerticalAlignment="Center"/>
                            </Grid>
                        </Border>

                        <!-- UDP Timeout -->
                        <TextBlock Text="UDP Timeout (seconds)"
                                   Style="{DynamicResource Text.Label}"/>
                        <TextBox x:Name="UdpTimeoutTextBox"
                                 Style="{DynamicResource TextBox.Modern}"
                                 Text="{Binding UdpTimeout, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                 Tag="60"
                                 Margin="0,0,0,8"/>

                        <!-- Kill Switch -->
                        <Border Background="{DynamicResource Brush.Background.Surface}"
                                CornerRadius="{DynamicResource Radius.M}"
                                Padding="16"
                                Margin="0,0,0,24">
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="Auto"/>
                                </Grid.ColumnDefinitions>
                                <StackPanel Grid.Column="0">
                                    <TextBlock Text="Kill Switch"
                                               Style="{DynamicResource Text.Body}"/>
                                    <TextBlock Text="Block traffic on disconnect"
                                               Style="{DynamicResource Text.Caption}"/>
                                </StackPanel>
                                <ToggleButton x:Name="KillSwitchToggle"
                                              Grid.Column="1"
                                              Style="{DynamicResource ToggleSwitch}"
                                              IsChecked="{Binding KillSwitch, Mode=TwoWay}"
                                              VerticalAlignment="Center"/>
                            </Grid>
                        </Border>

                        <!-- Encryption Section -->
                        <TextBlock Text="Encryption"
                                   Style="{DynamicResource Text.SubHeader}"
                                   Margin="0,0,0,16"/>

                        <!-- Encryption Mode -->
                        <TextBlock Text="Encryption Mode"
                                   Style="{DynamicResource Text.Label}"/>
                        <ComboBox x:Name="EncryptionModeComboBox"
                                  Style="{DynamicResource ComboBox.Modern}"
                                  SelectedValue="{Binding EncryptionMode, Mode=TwoWay}"
                                  SelectedValuePath="Tag"
                                  Margin="0,0,0,16">
                            <ComboBoxItem Content="None" Tag="none" Style="{DynamicResource ComboBoxItem.Modern}"/>
                            <ComboBoxItem Content="AES-128" Tag="aes128" Style="{DynamicResource ComboBoxItem.Modern}"/>
                            <ComboBoxItem Content="AES-256" Tag="aes256" Style="{DynamicResource ComboBoxItem.Modern}"/>
                            <ComboBoxItem Content="ChaCha20" Tag="chacha20" Style="{DynamicResource ComboBoxItem.Modern}"/>
                        </ComboBox>

                        <!-- Encryption Key -->
                        <TextBlock Text="Encryption Key"
                                   Style="{DynamicResource Text.Label}"/>
                        <Grid Margin="0,0,0,24">
                            <PasswordBox x:Name="EncryptionKeyPasswordBox"
                                         Style="{DynamicResource PasswordBox.Modern}"
                                         PasswordChanged="EncryptionKeyPasswordBox_PasswordChanged"/>
                            <TextBox x:Name="EncryptionKeyTextBox"
                                     Style="{DynamicResource TextBox.Modern}"
                                     Text="{Binding EncryptionKey, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                     Visibility="Collapsed"/>
                            <Button x:Name="ToggleEncryptionKeyButton"
                                    Style="{DynamicResource Button.Icon}"
                                    Click="ToggleEncryptionKeyVisibility_Click"
                                    HorizontalAlignment="Right"
                                    Margin="0,0,4,0"
                                    Width="32" Height="32">
                                <Path x:Name="EncryptionKeyToggleIcon"
                                      Data="{DynamicResource Icon.Eye}"
                                      Fill="{DynamicResource Brush.Text.Secondary}"
                                      Width="16" Height="16"
                                      Stretch="Uniform"/>
                            </Button>
                        </Grid>

                        <!-- Auto-Restart Section -->
                        <TextBlock Text="Auto-Restart on High Latency"
                                   Style="{DynamicResource Text.SubHeader}"
                                   Margin="0,0,0,16"/>

                        <!-- Auto-Restart Toggle -->
                        <Border Background="{DynamicResource Brush.Background.Surface}"
                                CornerRadius="{DynamicResource Radius.M}"
                                Padding="16"
                                Margin="0,0,0,16">
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="Auto"/>
                                </Grid.ColumnDefinitions>
                                <StackPanel Grid.Column="0">
                                    <TextBlock Text="Enable Auto-Restart"
                                               Style="{DynamicResource Text.Body}"/>
                                    <TextBlock Text="Automatically restart tunnel on high latency"
                                               Style="{DynamicResource Text.Caption}"/>
                                </StackPanel>
                                <ToggleButton x:Name="AutoRestartToggle"
                                              Grid.Column="1"
                                              Style="{DynamicResource ToggleSwitch}"
                                              IsChecked="{Binding AutoRestartOnHighLatency, Mode=TwoWay}"
                                              VerticalAlignment="Center"/>
                            </Grid>
                        </Border>

                        <!-- Latency Settings Grid -->
                        <Grid Margin="0,0,0,8">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="12"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>

                            <StackPanel Grid.Column="0">
                                <TextBlock Text="Latency Threshold (ms)"
                                           Style="{DynamicResource Text.Label}"/>
                                <TextBox Style="{DynamicResource TextBox.Modern}"
                                         Text="{Binding LatencyThresholdMs, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"/>
                            </StackPanel>

                            <StackPanel Grid.Column="2">
                                <TextBlock Text="Consecutive High Readings"
                                           Style="{DynamicResource Text.Label}"/>
                                <TextBox Style="{DynamicResource TextBox.Modern}"
                                         Text="{Binding HighLatencyCountThreshold, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"/>
                            </StackPanel>
                        </Grid>

                        <Grid Margin="0,0,0,24">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="12"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>

                            <StackPanel Grid.Column="0">
                                <TextBlock Text="Restart Cooldown (seconds)"
                                           Style="{DynamicResource Text.Label}"/>
                                <TextBox Style="{DynamicResource TextBox.Modern}"
                                         Text="{Binding RestartCooldownSeconds, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"/>
                            </StackPanel>

                            <StackPanel Grid.Column="2">
                                <TextBlock Text="Max Auto-Restarts (0 = unlimited)"
                                           Style="{DynamicResource Text.Label}"/>
                                <TextBox Style="{DynamicResource TextBox.Modern}"
                                         Text="{Binding MaxAutoRestarts, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"/>
                            </StackPanel>
                        </Grid>

                        <!-- Logging Section -->
                        <TextBlock Text="Logging"
                                   Style="{DynamicResource Text.SubHeader}"
                                   Margin="0,0,0,16"/>

                        <!-- Log Level -->
                        <TextBlock Text="Log Level"
                                   Style="{DynamicResource Text.Label}"/>
                        <ComboBox x:Name="LogLevelComboBox"
                                  Style="{DynamicResource ComboBox.Modern}"
                                  SelectedValue="{Binding LogLevel, Mode=TwoWay}"
                                  SelectedValuePath="Tag"
                                  Margin="0,0,0,24">
                            <ComboBoxItem Content="Debug (All logs)" Tag="DEBUG" Style="{DynamicResource ComboBoxItem.Modern}"/>
                            <ComboBoxItem Content="Info" Tag="INFO" Style="{DynamicResource ComboBoxItem.Modern}"/>
                            <ComboBoxItem Content="Warning (Default)" Tag="WARN" Style="{DynamicResource ComboBoxItem.Modern}" IsSelected="True"/>
                            <ComboBoxItem Content="Error" Tag="ERROR" Style="{DynamicResource ComboBoxItem.Modern}"/>
                            <ComboBoxItem Content="Fatal (Critical only)" Tag="FATAL" Style="{DynamicResource ComboBoxItem.Modern}"/>
                        </ComboBox>

                        <!-- Application Behavior Section -->
                        <TextBlock Text="Application Behavior"
                                   Style="{DynamicResource Text.SubHeader}"
                                   Margin="0,0,0,16"/>

                        <!-- Auto Connect -->
                        <Border Background="{DynamicResource Brush.Background.Surface}"
                                CornerRadius="{DynamicResource Radius.M}"
                                Padding="16"
                                Margin="0,0,0,8">
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="Auto"/>
                                </Grid.ColumnDefinitions>
                                <StackPanel Grid.Column="0">
                                    <TextBlock Text="Auto Connect"
                                               Style="{DynamicResource Text.Body}"/>
                                    <TextBlock Text="Connect automatically on startup"
                                               Style="{DynamicResource Text.Caption}"/>
                                </StackPanel>
                                <ToggleButton x:Name="AutoConnectToggle"
                                              Grid.Column="1"
                                              Style="{DynamicResource ToggleSwitch}"
                                              IsChecked="{Binding AutoConnect, Mode=TwoWay}"
                                              VerticalAlignment="Center"/>
                            </Grid>
                        </Border>

                        <!-- Minimize to Tray -->
                        <Border Background="{DynamicResource Brush.Background.Surface}"
                                CornerRadius="{DynamicResource Radius.M}"
                                Padding="16"
                                Margin="0,0,0,8">
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="Auto"/>
                                </Grid.ColumnDefinitions>
                                <StackPanel Grid.Column="0">
                                    <TextBlock Text="Minimize to Tray"
                                               Style="{DynamicResource Text.Body}"/>
                                    <TextBlock Text="Minimize to system tray on close"
                                               Style="{DynamicResource Text.Caption}"/>
                                </StackPanel>
                                <ToggleButton x:Name="MinimizeToTrayToggle"
                                              Grid.Column="1"
                                              Style="{DynamicResource ToggleSwitch}"
                                              IsChecked="{Binding MinimizeToTray, Mode=TwoWay}"
                                              VerticalAlignment="Center"/>
                            </Grid>
                        </Border>

                        <!-- Start Minimized -->
                        <Border Background="{DynamicResource Brush.Background.Surface}"
                                CornerRadius="{DynamicResource Radius.M}"
                                Padding="16"
                                Margin="0,0,0,24">
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="Auto"/>
                                </Grid.ColumnDefinitions>
                                <StackPanel Grid.Column="0">
                                    <TextBlock Text="Start Minimized"
                                               Style="{DynamicResource Text.Body}"/>
                                    <TextBlock Text="Start application minimized to tray"
                                               Style="{DynamicResource Text.Caption}"/>
                                </StackPanel>
                                <ToggleButton x:Name="StartMinimizedToggle"
                                              Grid.Column="1"
                                              Style="{DynamicResource ToggleSwitch}"
                                              IsChecked="{Binding StartMinimized, Mode=TwoWay}"
                                              VerticalAlignment="Center"/>
                            </Grid>
                        </Border>

                        <!-- Config Actions -->
                        <WrapPanel Orientation="Horizontal" Margin="0,0,0,16">
                            <Button Style="{DynamicResource Button.Secondary}"
                                    Click="ImportConfig_Click"
                                    Margin="0,0,8,8">
                                <StackPanel Orientation="Horizontal">
                                    <Path Data="{DynamicResource Icon.Import}"
                                          Fill="{DynamicResource Brush.Text.Secondary}"
                                          Width="14" Height="14"
                                          Stretch="Uniform"
                                          Margin="0,0,6,0"/>
                                    <TextBlock Text="Import Config"/>
                                </StackPanel>
                            </Button>
                            <Button Style="{DynamicResource Button.Secondary}"
                                    Click="ExportConfig_Click"
                                    Margin="0,0,8,8">
                                <StackPanel Orientation="Horizontal">
                                    <Path Data="{DynamicResource Icon.Export}"
                                          Fill="{DynamicResource Brush.Text.Secondary}"
                                          Width="14" Height="14"
                                          Stretch="Uniform"
                                          Margin="0,0,6,0"/>
                                    <TextBlock Text="Export Config"/>
                                </StackPanel>
                            </Button>
                            <Button Style="{DynamicResource Button.Secondary}"
                                    Click="ResetConfig_Click"
                                    Margin="0,0,0,8">
                                <StackPanel Orientation="Horizontal">
                                    <Path Data="{DynamicResource Icon.Reset}"
                                          Fill="{DynamicResource Brush.Text.Secondary}"
                                          Width="14" Height="14"
                                          Stretch="Uniform"
                                          Margin="0,0,6,0"/>
                                    <TextBlock Text="Reset Defaults"/>
                                </StackPanel>
                            </Button>
                        </WrapPanel>

                        <!-- GitHub Link -->
                        <Border Background="{DynamicResource Brush.Background.Surface}"
                                CornerRadius="{DynamicResource Radius.M}"
                                Padding="16"
                                Margin="0,8,0,0"
                                Cursor="Hand"
                                MouseLeftButtonUp="GitHubLink_Click">
                            <StackPanel Orientation="Vertical" HorizontalAlignment="Center">
                                <StackPanel Orientation="Horizontal" HorizontalAlignment="Center">
                                    <Path Data="{DynamicResource Icon.GitHub}"
                                          Fill="{DynamicResource Brush.Text.Secondary}"
                                          Width="20" Height="20"
                                          Stretch="Uniform"
                                          Margin="0,0,10,0"
                                          VerticalAlignment="Center"/>
                                    <TextBlock Text="View on GitHub"
                                               Style="{DynamicResource Text.Body}"
                                               Foreground="{DynamicResource Brush.Primary}"
                                               VerticalAlignment="Center"/>
                                </StackPanel>
                                <TextBlock x:Name="AppVersionText"
                                           Text="Version 1.0.0.0"
                                           Style="{DynamicResource Text.Caption}"
                                           Foreground="{DynamicResource Brush.Text.Secondary}"
                                           HorizontalAlignment="Center"
                                           Margin="0,8,0,0"
                                           TextAlignment="Center"/>
                            </StackPanel>
                        </Border>
                    </StackPanel>
                </ScrollViewer>
            </Grid>
        </Grid>
            </Grid>
        </Grid>
    </Border>
</Window>
